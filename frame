#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
VENV_PYTHON="$SCRIPT_DIR/venv/bin/python"
SCRIPT_PY="$SCRIPT_DIR/frame_auto_date_title.py"

INPUT_DIR="$SCRIPT_DIR/photo"
OUTPUT_DIR="$SCRIPT_DIR/framed"

if [[ ${1:-} == "-h" || ${1:-} == "--help" ]]; then
  cat <<'USAGE'
Usage: frame [input_dir] [output_dir] [extra_python_args...]

Defaults:
  input_dir  = ./photo
  output_dir = ./framed

Examples:
  frame
  frame ./photo ./framed --border 90 --bottom 260
USAGE
  exit 0
fi

if [[ $# -ge 1 ]]; then
  INPUT_DIR="$1"
  shift
fi

if [[ $# -ge 1 ]]; then
  OUTPUT_DIR="$1"
  shift
fi

if [[ ! -x "$VENV_PYTHON" ]]; then
  echo "Error: venv python not found at $VENV_PYTHON" >&2
  exit 1
fi

if [[ ! -f "$SCRIPT_PY" ]]; then
  echo "Error: script not found at $SCRIPT_PY" >&2
  exit 1
fi

"$VENV_PYTHON" "$SCRIPT_PY" --input "$INPUT_DIR" --output "$OUTPUT_DIR" "$@"
